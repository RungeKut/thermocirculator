(self.webpackChunkvkwidgets=self.webpackChunkvkwidgets||[]).push([[994],{39565:(t,e,s)=>{"use strict";s.d(e,{browser:()=>i,mobPlatforms:()=>a,redirectToMVK:()=>c});s(14073),s(91310);var n=s(41094),o=s(946);const r=navigator.userAgent.toLowerCase(),i={version:(r.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],opera:/opera/i.test(r)||/opr/i.test(r),vivaldi:/vivaldi/i.test(r),amigo:/amigo.*mrchrome soc/i.test(r),msie:/msie/i.test(r)&&!/opera/i.test(r)||/trident\//i.test(r)||/edge/i.test(r),msie6:/msie 6/i.test(r)&&!/opera/i.test(r),msie7:/msie 7/i.test(r)&&!/opera/i.test(r),msie8:/msie 8/i.test(r)&&!/opera/i.test(r),msie9:/msie 9/i.test(r)&&!/opera/i.test(r),msie_edge:/edge/i.test(r)&&!/opera/i.test(r),mozilla:/firefox/i.test(r),yabrowser:/yabrowser/i.test(r),whale:/whale/i.test(r),chrome:/chrome/i.test(r)&&!/edge/i.test(r),safari:!/chrome/i.test(r)&&/webkit|safari|khtml/i.test(r),iphone:/iphone/i.test(r),ipod:/ipod/i.test(r),iphone4:/iphone.*OS 4/i.test(r),ipod4:/ipod.*OS 4/i.test(r),ipad:/ipad/i.test(r),ios:/.+(ipod|ipad|iphone.*os)/i.test(r),android:/android/i.test(r),bada:/bada/i.test(r),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(r),msie_mobile:/iemobile/i.test(r),safari_mobile:/iphone|ipod|ipad/i.test(r),opera_mobile:/opera mini|opera mobi/i.test(r),opera_mini:/opera mini/i.test(r),mac:/mac/i.test(r),windows7:/windows nt 6.1/i.test(r),windowsVista:/windows nt 6.0/i.test(r),windowsXp:/windows nt (5.2|5.1)/i.test(r),search_bot:/(yandex|google|stackrambler|aport|slurp|msnbot|bingbot|twitterbot|ia_archiver|facebookexternalhit)/i.test(r),smart_tv:/smart-tv|smarttv/i.test(r)};const a={1:1,2:1,3:1,4:1,5:1,8:1};window,"onwheel"in document.createElement("div")||void 0!==document.onmousewheel||i.mozilla,document.createElement("div"),navigator.credentials&&navigator.credentials.preventSilentAccess&&window.vk&&vk.cma;function c(){const[t,e]=location.href.split("?"),s=new URLSearchParams(e),r={};for(let t of s)r[t[0]]=t[1];if(r){if("1"===r.m)return;if(r.force_redirect_to_mvk){delete r.force_redirect_to_mvk;const e=(0,n.toQueryString)(r);return void(window.location=t.replace(o.VK_ORIGIN_REGEX_STRICT,"https://m."+(0,o.getHostName)())+(e?"?"+e:""))}}if(o.VK_URL_REGEX.test(t)&&!new RegExp("^"+o.VK_HOST_REGEX_UNSAFE.source+"\\/@").test(t)){const e=Object.assign(r,{force_redirect_to_mvk:1}),s=t+"?"+(0,n.toQueryString)(e);window.location=s}}},41094:(t,e,s)=>{"use strict";s.d(e,{fromQueryString:()=>l,toQueryString:()=>c});let n={};const o=t=>"function"==typeof t,r=t=>Array.isArray(t),i=function(t){if(n[t])return t;try{return encodeURIComponent(t)}catch(t){return""}},a=function(t){try{return decodeURIComponent(t)}catch(e){return n[t]=1,t}};function c(t,e){const s=[];for(const e in t)if(t.hasOwnProperty(e)&&null!=t[e]&&!o(t[e]))if(r(t[e]))for(let n=0,r=0,a=t[e].length;n<a;++n)null==t[e][n]||o(t[e][n])||(s.push(i(e)+"["+r+"]="+i(t[e][n])),++r);else s.push(i(e)+"="+i(t[e]));return e||s.sort(),s.join("&")}function l(t){if(!t)return{};const e={};t=t.split("&");for(let s=0;s<t.length;s++){const n=t[s].split("=");if(n[0]){const t=a(n[1]+"");if("[]"===n[0].substr(n.length-2)){const s=a(n[0].substr(0,n.length-2));e[s]||(e[s]=[]),e[s].push(t)}else e[a(n[0])]=t}}return e}},91310:(t,e,s)=>{"use strict";s.d(e,{getCookie:()=>a,setCookie:()=>l});var n=s(48370),o=s(25324),r=s(59926),i=s(39565);function a(t){return function(){window._cookies={};const t=document.cookie.split(";"),e=/^[\s]*([^\s]+?)$/i;for(let s=0,n=t.length;s<n;s++){const n=t[s].split("=");2===n.length&&(_cookies[n[0].match(e)[1]]=unescape(n[1].match(e)?n[1].match(e)[1]:""))}}(),"https:"!==location.protocol&&"localhost"!==location.hostname&&(0,o.statlogsValueEvent)("read_unsecure_cookie",t,location.href),_cookies[t]}function c(t,e){const s=(0,n.getCookieGroups)(),o=function(){const t=a("remixcpl");if(!t)return[];const e=t.split(",");return e.forEach(((t,s)=>{e[s]=parseInt(t)})),e}();let i=t,c=null;if(!(0,n.partConfigEnabled)("need_check_allowed_cookie"))return!0;if(!isNaN(parseInt(e))&&parseInt(e)<0)return!0;"remix"===i.substr(0,5)&&(i=i.substr(5)),s.hasOwnProperty(t)?c=parseInt(s[t]):s.hasOwnProperty(i)?c=parseInt(s[i]):"q_"===i.substr(0,2)&&s.hasOwnProperty("q_")&&(c=parseInt(s.q_)),(null===c||isNaN(c))&&(0,r.logError)(`Undefined cookie group for cookie ${t} (${i})`);return 1===c||!(isNaN(c)||!o.includes(c))}function l(t,e,s,o,r="None",a=window.locDomain,l={}){if(!c(t,s))return!1;const u=t+"="+escape(e),d=l.withoutSubdomains?".":"",g="; path=/"+(a?"; domain="+d+a:""),m="https:"===location.protocol;let h=!!o;(0,n.partConfigEnabled)("cookie_secure_default_true")&&(h=!1!==o);const p=m&&h?"; secure":"",f=h&&i.browser.chrome&&parseInt(i.browser.version)>=71&&(0,n.partConfigEnabled)("cookie_class_samesite")?`; SameSite=${r}`:"";let w="";if(s){const t=new Date;t.setTime(t.getTime()+24*s*60*60*1e3),w="; expires="+t.toGMTString()}return document.cookie=u+w+g+f+p,!0}},14073:(t,e,s)=>{"use strict";function n(t=window.browser){return!(!t.mac||t.iphone||t.ipad||t.ipod||!(navigator.maxTouchPoints>1))}s.d(e,{isIPadOS:()=>n})},25324:(t,e,s)=>{"use strict";s.d(e,{statlogsValueEvent:()=>f});var n=s(91310),o=s(946),r=s(16556),i=s(12664),a=s(48370),c=s(81868),l=s(14766);let u,d,g,m;(0,o.isMvk)()?(u="lock_m_stats_cookie_lock",d="remixmstsl",g="lock_m_stats_cookie_locked_stats",m="remixmsts"):(u="lockkk_stats_cookie_lock",m="remixsts",d="remixstsl",g="lock_stats_cookie_locked_stats");const h=[],p={get stats(){return(r.ls.checkVersion()?JSON.parse(r.ls.get(g)):this._stats)||[]},push(t){const e=this.stats;e.push(t),r.ls.checkVersion()?r.ls.set(g,JSON.stringify(e)):this._stats=e},clear(){r.ls.checkVersion()?r.ls.remove(g):delete this._stats}};function f(t,e,...s){if(void 0===t||void 0===e)return;if(h.forEach((n=>n(t,e,...s))),(0,a.partConfigEnabled)("local_storage_statlogs_value_event")&&![c.ADBLOCK_CONFIG_KEY,l.WASM_SUPPORT_CONFIG_KEY].includes(t))return void(0,i.saveStatlogEvents)({name:t,value:e,keys:s});const o=[Math.round(Date.now()/1e3),t,e].concat(s);S((()=>{if((0,a.partConfigEnabled)("mvk_stats_cookie_soft_clean_up")){if("1"===(0,n.getCookie)(d))return void p.push(o);(0,n.setCookie)(d,"1")}w(o)}))}function w(t){let e;try{e=JSON.parse((0,n.getCookie)(m)),e=e.data}catch(t){e=[]}if(e=[...e,...p.stats],t&&e.push(t),0===e.length)return;const s=1000000001*Math.random();(0,n.setCookie)(m,JSON.stringify({data:e.slice(-100),uniqueId:s}),.01),p.clear()}function S(t,e){if(r.ls.checkVersion()){if(!0!==r.ls.get(u)){r.ls.set(u,!0);try{t()}catch(t){}return void r.ls.set(u,!1)}e||setTimeout((()=>S(t,!0)),100)}else t()}(0,a.partConfigEnabled)("mvk_stats_cookie_soft_clean_up")&&(window.addEventListener("beforeunload",(()=>{w(null)})),window.ajax&&window.ajax.onResponse((()=>{w(null)})))},48370:(t,e,s)=>{"use strict";s.d(e,{calculateTimeOffsets:()=>a,getConfigValue:()=>r,getCookieGroups:()=>i,partConfigEnabled:()=>o});var n=s(91310);function o(t){const{pe:e={}}=window.vk||{};return!!e[t]}function r(t){const{cfg:e={}}=window.vk||{};return e[t]}function i(){const{acl:t={}}=window.vk||{};return t}function a(){const t=window.vk.ts;if(t&&!window.browser.opera_mobile){const e=new Date;let s=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())/1e3-t;s-=10800,s/=60,s=s.toFixed(0),s*=60,s<-55800?s+=86400:s>37800&&(s-=86400);let o=0,r=Math.abs(s);[-12,-11,-10,-9.5,-9,-8,-7,-6,-5,-4.5,-4,-3.5,-3,-2,-1,0,1,2,3,3.5,4,4.5,5,5.5,5.75,6,6.5,7,8,8.75,9,9.5,10,10.5,11,12,12.75,13,14].forEach((t=>{const e=Math.round(3600*(t-3)),n=Math.abs(s-e);n<r&&(r=n,o=e)}));const i=(0,n.getCookie)("remixdt");return void 0!==i&&function(t){if(!0===t)return 1;return parseInt(t)||0}(i)===o||(0,n.setCookie)("remixdt",o,365),o}return 0}},6551:(t,e,s)=>{"use strict";s.d(e,{logError:()=>o});var n=s(15160);function o(t,{breadcrumb:e,environment:s,hasDummyStacktrace:o}={}){const r=(0,n.getGlobalObject)().__SENTRY__?.hub;if(r)return o&&t.stack&&delete t.stack,r.captureException(t,{captureContext:t=>(s&&t.setTags({module:s}),e&&t.addBreadcrumb({message:e.message,category:"custom",data:e.data}),t)})}},15160:(t,e,s)=>{"use strict";function n(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}s.d(e,{getGlobalObject:()=>n})},67761:(t,e,s)=>{"use strict";s.d(e,{getBrowserFingerprint:()=>o});var n=s(91310);function o(){return(0,n.getCookie)("remixgp")}},83777:(t,e,s)=>{"use strict";s.d(e,{debugBufferLog:()=>u,logError:()=>a,logEvalError:()=>l,logUnknownError:()=>c});var n=s(48370),o=s(13847),r=s(90255),i=s(6551);function a(t,e={}){if(window?.Raven){const{breadcrumb:s,environment:n}=e;s&&window.Raven.captureBreadcrumb({message:s.message,category:r.customBreadcrumbCategory,data:s.data}),n?window.Raven.captureException(t,{environment:n}):window.Raven.captureException(t)}(0,n.partConfigEnabled)("eager_error_monitoring")?(0,i.logError)(t,e):(0,o.logError)(t,e)}function c(t){if(t instanceof Error)return void a(t);let e="unknown error";if("string"==typeof t&&(e=t),"object"==typeof t&&null!==t&&"message"in t){const{message:s}=t;"string"==typeof s&&(e=s)}a(new Error(e))}function l(t,e){e&&e.length>2e3&&(e=`${e.slice(0,1e3)}...${e.slice(-1e3)}`),t.message+=`: ${e}`,a(t)}function u(t){return a(t,{environment:"debugLog"})}},98173:(t,e,s)=>{"use strict";s.d(e,{isStuckError:()=>g,pruneRequestFromStuckErrors:()=>m});var n=s(48370),o=s(17672),r=s(67013);const i="mvk"===window.vk?.statsMeta?.platform&&(0,n.partConfigEnabled)("mute_mvk_err_peaks"),a=s(47201),c=10,l=i&&a(c),u=i&&a(c,5e3),d=({value:t,stacktrace:e,file:s,page:n})=>[t,e.join(""),s,n].join("_"),g=t=>{if(!i||!u||!l)return!1;const e=d(t);let[s,n]=[l.get(e)||0,u.get(e)||0];return l.set(e,++s),u.set(e,++n),n>=c||s>=50},m=i?t=>{const e=Date.now(),s="jsErrorLogs",n=(0,o.getWebStatsStringValue)(s,t);let i;if((n.match(new RegExp("},{","g"))?.length||0)<c)return t;try{i=JSON.parse(n)}catch(t){(0,r.logProcessingTime)(1,"dedupe-fail")}if(!i)return t;const a=Object.values(i.reduce(((t,e)=>{const s=d(e),n=t[s]||[];return{...t,[s]:n.length<c?n.concat(e):n}}),{})),l=t.replace(`"${s}":${n}`,`"${s}":${JSON.stringify([].concat.apply([],a))}`),u=Date.now()-e;return u>16&&(0,r.logProcessingTime)(u,"dedupe"),l}:t=>t},59926:(t,e,s)=>{"use strict";s.d(e,{debugBufferLog:()=>n.debugBufferLog,logError:()=>n.logError,logEvalError:()=>n.logEvalError});s(76154);var n=s(83777)},76154:(t,e,s)=>{"use strict";s(12664),s(98173)},16556:(t,e,s)=>{"use strict";s.d(e,{ls:()=>c,multiAccountLs:()=>d});var n=s(90056);function o(){try{return void 0!==window.localStorage&&null!==window.localStorage&&void 0!==window.JSON}catch(t){return!1}}function r(t,e){if(void 0===t)return!1;a(t);try{return n.vkLocalStorage.setItem(t,JSON.stringify(e))}catch(t){return!1}}function i(t){if(void 0===t)return!1;try{return JSON.parse(n.vkLocalStorage.getItem(t))}catch(t){return!1}}function a(t){try{n.vkLocalStorage.removeItem(t)}catch(t){}}const c={checkVersion:o,remove:a,get:i,set:r},l=t=>void 0!==t?`${t}_@id:${window.vk.id}`:void 0,u=t=>(...e)=>{const[s,...n]=e,o=[l(s),...n];return t(...o)},d={checkVersion:o,remove:u(a),get:t=>{const e=u(i)(t);if(null===e){const e=i(t);if(null!==e)return d.set(t,e),a(t),e}return e},set:u(r)}},90255:(t,e,s)=>{"use strict";var n,o;s.d(e,{PROTECTED_MODULE_NAME_TAG:()=>r,customBreadcrumbCategory:()=>a,topErrorModuleName:()=>i}),function(t){t.SERVICE_WORKER="service_worker",t.EXTERNAL="external",t.UNKNOWN="unknown"}(n||(n={})),function(t){t.ERROR_OF_EXTENSION="ErrorOfExtension",t.KNOWN_ISSUE="KnownIssue"}(o||(o={}));const r="__protectedModuleName",i="genericVkError",a="custom";["chrome","moz","safari","safari-web"].map((t=>`${t}-extension://`))},13847:(t,e,s)=>{"use strict";s.d(e,{logError:()=>r});var n=s(946),o=s(90255);function r(t,{breadcrumb:e,environment:s,hasDummyStacktrace:r}={}){const i=(0,n.getGlobalObject)(),a=i?.__SENTRY__?.hub;if("function"==typeof a?.captureException)return r&&"object"==typeof t&&t?.stack&&delete t.stack,a.captureException(t,{captureContext:t=>{const n=s||i.cur?.module;return n&&t.setTags({module:n,[o.PROTECTED_MODULE_NAME_TAG]:!0}),e&&t.addBreadcrumb({message:e.message,category:o.customBreadcrumbCategory,data:e.data}),t}})}},946:(t,e,s)=>{"use strict";s.d(e,{VK_DOMAIN_REGEX:()=>d,VK_HOST_REGEX_GROUP_UNSAFE:()=>l,VK_HOST_REGEX_UNSAFE:()=>c,VK_ORIGIN_PREFIX_REGEX:()=>m,VK_ORIGIN_REGEX_STRICT:()=>g,VK_POSSIBLE_SITE_HOSTS:()=>o,VK_SITES_REGEX_SOURCE_UNSAFE:()=>a,VK_SITE_REGEX_SOURCE_UNSAFE:()=>i,VK_URL_REGEX:()=>h,VK_URL_REGEX_STRICT:()=>p,getGlobalObject:()=>_,getHostName:()=>S,isMvk:()=>f,isPWA:()=>w});const n=t=>t.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1"),o=["vk.com","vk.ru",S()].filter(((t,e,s)=>s.indexOf(t)===e)),r=o.concat(["vkontakte.ru","vk.me","userapi.com"]),i=n(S()),a=o.map(n).join("|"),c=new RegExp("("+r.map(n).join("|")+")"),l=new RegExp(r.map(n).join("|")),u=(new RegExp("^"+c.source+"$"),new RegExp(`([a-zA-Z0-9\\.\\_\\-]+\\.)?${c.source}`)),d=new RegExp("^"+u.source+"$"),g=(new RegExp(`^(https?:\\/\\/)?${u.source}$`),new RegExp(`^(https?:\\/\\/)${u.source}$`)),m=new RegExp(`^(https?:\\/\\/)${u.source}`),h=new RegExp(`^(https?:\\/\\/)?${u.source}($|\\/(.*))`),p=new RegExp(`^(https?:\\/\\/)${u.source}($|\\/(.*))`);function f(){return!!window.isMVK}function w(){return window.vk?.platform?.startsWith?.("pwa")}function S(){return _().vk?.__domain||"vk.com"}function _(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}},90056:(t,e,s)=>{"use strict";s.d(e,{bestAvailableStorage:()=>f,getSessionStorage:()=>g,isStorageAvailable:()=>a,vkLocalStorage:()=>u,vkSessionStorage:()=>m});class n{setItem(t,e){this.data[t]=String(e)}removeItem(t){delete this.data[t]}clear(){this.data={}}get length(){return Object.keys(this.data).length}key(t){return Object.keys(this.data)[t]}constructor(){this.data={},this.getItem=t=>this.data.hasOwnProperty(t)?this.data[t]:null,this.keys=()=>Object.keys(this.data)}}const o="vk-ls-dummy",r=Math.random().toString(),i={localStorage:null,sessionStorage:null};function a(t){if(null===i[t])try{const e=window[t];e.setItem(o,r),i[t]=r===e.getItem(o),e.removeItem(o)}catch(e){i[t]=!1}return i[t]}let c;function l(){return c||(c=a("localStorage")?window.localStorage:new n,c)}const u={setItem:(t,e)=>l().setItem(t,e),getItem:t=>l().getItem(t),removeItem:t=>l().removeItem(t),clear:()=>l().clear(),length:()=>l().length,key:t=>l().key(t),keys(){const t=l();return t instanceof n?t.keys():Object.keys(t)},getPrefixedKeys:t=>u.keys().filter((e=>e.startsWith(t)))};let d;function g(){return d||(d=a("sessionStorage")?window.sessionStorage:new n,d)}const m={setItem:(t,e)=>g().setItem(t,e),getItem:t=>g().getItem(t),removeItem:t=>g().removeItem(t),clear:()=>g().clear(),length:()=>g().length,key:t=>g().key(t),keys(){const t=g();return t instanceof n?t.keys():Object.keys(t)},getPrefixedKeys:t=>m.keys().filter((e=>e.startsWith(t)))};let h;function p(){return h||(h=a("localStorage")?window.localStorage:a("sessionStorage")?window.sessionStorage:new n,h)}const f={setItem:(t,e)=>p().setItem(t,e),getItem:t=>p().getItem(t),removeItem:t=>p().removeItem(t),clear:()=>p().clear(),length:()=>p().length,key:t=>p().key(t),keys(){const t=p();return t instanceof n?t.keys():Object.keys(t)},getPrefixedKeys:t=>f.keys().filter((e=>e.startsWith(t)))}},74839:(t,e,s)=>{"use strict";s.d(e,{saveStats:()=>b});var n=s(17672),o=s(79294),r=s(67013),i=s(946),a=s(59185),c=s(98173),l=s(48370),u=s(67761),d=s(11438);function g(){if(!(0,l.partConfigEnabled)("web_stats_reduce_debounce"))return!1;const t=window.vk?.started||Date.now();return Date.now()-t<=3e4}const m=()=>g()?1e3:1e4,h=()=>g()?5e3:2e4;let p,f=0;const w=()=>m()*f**.5,S=()=>!(Date.now()-(0,n.getLastSendTime)()>h()+w()),_=()=>Math.max(0,(0,n.getLastSendTime)()+(g()?2e3:2e4)-Date.now()),v=()=>{window.__isSendingWebStats||p||(p=window.setTimeout((()=>{const t=(0,n.getWebStatDataLs)();p=void 0,t.length>n.emptyStatsDataLs.length&&b(t)}),Math.max(Math.min(_(),m()),Math.max(0,(0,n.getLastSendTime)()+h()-Date.now()+w()))))},k=t=>{let e="";if((0,l.partConfigEnabled)("web_stats_device_id")){const t=new URLSearchParams,s=(0,u.getBrowserFingerprint)();s&&t.set("device_id",s),e=t.toString()}const s=`${window.vk.wsTransport}/web-stats/${window.vk.statsMeta.st?"s":"p"}${e&&`?${e}`}`,o=t.length>r.MAX_BODY_SIZE;let g=o?(0,d.getMaximumWebStats)(t):t,m=!1;if(!g)return window.__isSendingWebStats=!1,(0,n.clearLsData)();function h(e){const s=Date.now();window.__isSendingWebStats=!1,e<500&&(o&&200===e?Object.keys((0,n.getEmptyStatsData)()).forEach((t=>(0,a.pullFromWebStats)(t,g))):(0,n.clearLsData)(),f=0,m=!0),(o||400===e)&&(0,r.logProcessingTime)(Date.now()-s,`${o?"prune":"clean"}${400===e?"-fail":""}`,`${t.length>>>20}M ${g.length>>>20}M`),v()}function p(){const t=new XMLHttpRequest;t.withCredentials=s.includes(`tau.${(0,i.getHostName)()}`),t.onreadystatechange=()=>{t.readyState===XMLHttpRequest.DONE&&h(t.status)},t.onerror=()=>{window.__isSendingWebStats=!1,!m&&(0,n.clearLsData)()},t.open("POST",s,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(g)}g=(0,c.pruneRequestFromStuckErrors)((0,r.appendStatsMeta)(++f,g)),(0,r.canSendBeacon)()?(0,r.sendBeacon)(s,g).then((()=>h(200))).catch((()=>p())):p()},E=(t,e)=>{const s=e=>setTimeout((()=>t()),e);return e?.force?s(0):window.requestIdleCallback?window.requestIdleCallback((()=>s(m())),{timeout:m()/2}):s(m())};function b(t,e){const s=t.length>=r.MAX_BODY_SIZE,i=e?.force||s;if(t.length<=n.emptyStatsDataLs.length)(0,o.logWebStatsEvent)("WebStats empty data.","");else{if(!window.__isSendingWebStats)return i||p||!S()?(window.__isSendingWebStats=!0,E((()=>{const t=(0,n.getWebStatDataLs)();if(t.length>n.emptyStatsDataLs.length&&(i||!S()))return(0,n.setLastSendTime)(),k(t);clearTimeout(p),window.__isSendingWebStats=!1,p=void 0}),{...e,force:i})):((0,o.logWebStatsEvent)("WebStats delayed.",p),v());(0,o.logWebStatsEvent)("WebStats sending.",window.__isSendingWebStats)}}},11438:(t,e,s)=>{"use strict";s.d(e,{getMaximumWebStats:()=>r});var n=s(17672),o=s(67013);const r=t=>{const e=Date.now(),s=t=>`{${t?.map((([t,e])=>`"${t}":${e}`)).join(",")}}`,[r,i]=Object.keys((0,n.getEmptyStatsData)()).reduce(((e,s)=>{const o=(0,n.getWebStatsStringValue)(s,t);return"[]"===o?e:[...e,[s,o]]}),[]).sort((([,t],[,e])=>e.length-t.length)).reduce((([t,e],[n,r])=>{const i=[[n,r]];return r.length+s(t).length<o.MAX_BODY_SIZE?[t.concat(i),e]:[t,e.concat(i)]}),[[],[]]),a=s(r);if((0,o.logProcessingTime)(Date.now()-e,"chunk"),Date.now()-e<500&&i[0]&&a.length<.1*o.MAX_BODY_SIZE){const t=Date.now();try{const e=((t,e)=>{const[s,n]=e,r=`{"${s}":[${JSON.parse(n).reduce(((e,s,n)=>e.length<o.MAX_BODY_SIZE-t.length?`${e}${0===n?"":","}${JSON.stringify(s)}`:e),"")}]}`;return"{}"===t?r:(0,o.concatJSONS)(t,r)||t})(a,i.reverse()[0]);return(0,o.logProcessingTime)(Date.now()-t,"batch"),e}catch(e){return(0,o.logProcessingTime)(Date.now()-t,"batch-fail"),""}}return a}},12664:(t,e,s)=>{"use strict";s.d(e,{saveCustomStats:()=>n.saveCustomStats,saveJsErrorLogs:()=>n.saveJsErrorLogs,saveNetworkStats:()=>n.saveNetworkStats,saveProductionStats:()=>n.saveProductionStats,saveStatlogEvents:()=>n.saveStatlogEvents});var n=s(59185)},67013:(t,e,s)=>{"use strict";s.d(e,{MAX_BODY_SIZE:()=>r,appendStatsMeta:()=>c,canSendBeacon:()=>u,concatJSONS:()=>a,logProcessingTime:()=>d,sendBeacon:()=>l});var n=s(25324),o=(s(98173),s(946));s(48370);const r=1.8*Math.pow(10,6),i=t=>t.startsWith("{")&&t.endsWith("}"),a=(t,e)=>[t,e].every(i)?`${t.slice(0,-1)},${e.substring(1)}`:"{}",c=(t,e)=>{const{id:s,statsMeta:{st:n,platform:o,...r}}=window.vk,{item_id:c,item_owner_id:l,item_type:u}=window.cur;return a(JSON.stringify({id:s,st:n,platform:o,attempt:t,signTime:r.time,sign:r.hash,...c&&{item_id:c},...u&&{item_type:u},...l&&{item_owner_id:l}}),i(e)?e:"{}")};function l(t,e){try{if(!navigator.sendBeacon(t,e))return Promise.reject(new Error("Beacon not sent"))}catch(t){return Promise.reject(new Error("Beacon fail"))}return Promise.resolve()}function u(){return"sendBeacon"in navigator&&!window.vk.wsTransport.includes(`tau.${(0,o.getHostName)()}`)}function d(t,e,s){(0,n.statlogsValueEvent)("web_stats_batching_time",t,window.vk.statsMeta.platform,e,s)}},59185:(t,e,s)=>{"use strict";s.d(e,{pullFromWebStats:()=>c,saveCustomStats:()=>h,saveJsErrorLogs:()=>u,saveNetworkStats:()=>m,saveProductionStats:()=>g,saveStatlogEvents:()=>d});var n=s(17672),o=s(79294),r=s(48370),i=s(74839),a=s(90056);const c=(t,e)=>{const s=(0,n.getWebStatsStringValue)(t,e);if("[]"!==s){const t=(0,n.getWebStatDataLs)().replace(s.slice(1,-1),"").replace(/\[\,/,"[");(0,n.writeLocked)((()=>a.vkLocalStorage.setItem(n.lsDataKey,t)))}},l=(t,e,s,r)=>{const c=((t,e)=>{const s=(0,n.getWebStatsStringValue)(t);return(0,n.getWebStatDataLs)().replace(`"${t}":${s}`,`"${t}":${s.replace(/]$/,`${"[]"===s?"":","}${JSON.stringify(e)}]`)}`)})(e,s);(0,n.writeLocked)((()=>{a.vkLocalStorage.setItem(n.lsDataKey,c),(0,i.saveStats)(c,r)})),(0,o.logWebStatsEvent)(t,s)},u=t=>l("saveJsErrorLogs","jsErrorLogs",t),d=({name:t,value:e,keys:s=[]})=>{const n=[Math.round(Number(Date.now())/1e3),t,e,...s];return(0,r.partConfigEnabled)("web_stats_transport_debugger")&&console.log("Data was transformed!"),l("saveStatlogEvents","statlogEvents",n)},g=(t,e)=>l("saveProductionStats","productionStats",t,e),m=t=>l("saveNetworkStats","networkStats",t),h=t=>l("saveCustomStats","customStats",t)},79294:(t,e,s)=>{"use strict";s.d(e,{logWebStatsEvent:()=>o});var n=s(48370);function o(t,e){(0,n.partConfigEnabled)("web_stats_transport_debugger")&&console.log(`[new transport debug] ${t}`,e)}},17672:(t,e,s)=>{"use strict";s.d(e,{clearLsData:()=>h,emptyStatsDataLs:()=>u,getEmptyStatsData:()=>l,getLastSendTime:()=>f,getWebStatDataLs:()=>g,getWebStatsStringValue:()=>m,lsDataKey:()=>i,setLastSendTime:()=>p,writeLocked:()=>d});var n=s(90056),o=s(79294);const r=(0,s(946).isMvk)()?"mvk":"web",i=`XHR_STATS_TRANSPORT_DATA_${r}`,a=`XHR_STATS_TRANSPORT_META_${r}`,c=`XHR_STATS_TRANSPORT_DATA_LOCK_${r}`,l=()=>({jsErrorLogs:[],statlogEvents:[],productionStats:[],storyViewStats:[],networkStats:[],customStats:[],webPerfStats:[],benchmarkMainStats:[]}),u=JSON.stringify(l());function d(t){if("locked"!==n.vkSessionStorage.getItem(c)){(0,o.logWebStatsEvent)("writeLocked","lock"),n.vkSessionStorage.setItem(c,"locked");try{t()}catch(t){}return(0,o.logWebStatsEvent)("writeLocked","free"),void n.vkSessionStorage.setItem(c,"free")}setTimeout((()=>d(t)),100)}const g=()=>n.vkLocalStorage.getItem(i)||u,m=(t,e=g())=>{const s=Object.keys(l()).filter((e=>e!==t)).join("|"),n=e?.match(new RegExp(`"${t}":(\\[.*?\\])(?:,"(${s})":\\[|}$)`))?.[1]||"";return(o=n).startsWith("[")&&o.endsWith("]")?n:"[]";var o};function h(t){t&&(0,o.logWebStatsEvent)("WebStats cleared. "+(t?"Reason: LS is broken.":""),t),d((()=>n.vkLocalStorage.setItem(i,"")))}function p(t=Number(new Date)){n.vkSessionStorage.setItem(a,t.toString())}function f(){return parseInt(`${n.vkSessionStorage.getItem(a)||0}`)}},81868:(t,e,s)=>{"use strict";s.d(e,{ADBLOCK_CONFIG_KEY:()=>n});const n="unique_adblock_users"},14766:(t,e,s)=>{"use strict";s.d(e,{WASM_SUPPORT_CONFIG_KEY:()=>n});const n="users_wasm_support"},47201:function(t){t.exports=function(){"use strict";class t{constructor(t=0,e=0){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.size=0,this.ttl=e}has(t){return t in this.items}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}evict(){const t=this.first;return delete this.items[t.key],this.first=t.next,this.first.prev=null,this.size--,this}get(t){let e;if(this.has(t)){const s=this.items[t];this.ttl>0&&s.expiry<=(new Date).getTime()?this.delete(t):(e=s.value,this.set(t,e,!0))}return e}keys(){return Object.keys(this.items)}set(t,e,s=!1){let n;if(s||this.has(t)){if(n=this.items[t],n.value=e,!1===s&&(n.expiry=this.ttl>0?(new Date).getTime()+this.ttl:this.ttl),this.last!==n){const t=this.last,e=n.next,s=n.prev;this.first===n&&(this.first=n.next),n.next=null,n.prev=this.last,t.next=n,null!==s&&(s.next=e),null!==e&&(e.prev=s)}}else this.max>0&&this.size===this.max&&this.evict(),n=this.items[t]={expiry:this.ttl>0?(new Date).getTime()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},1==++this.size?this.first=n:this.last.next=n;return this.last=n,this}}return function(e=1e3,s=0){if(isNaN(e)||e<0)throw new TypeError("Invalid max value");if(isNaN(s)||s<0)throw new TypeError("Invalid ttl value");return new t(e,s)}}()}}]);try{stManager.done("dist/api/widgets/chunks/c3d11fba.5504cac7.js")}catch(t){}